<!doctype html><html lang=en-in><head><meta http-equiv=x-clacks-overhead content="GNU Terry Pratchett"><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" href=http://shabinesh.github.io/images/favicon.png><title>Docker Golang | Sab's</title><meta name=title content="Docker Golang"><meta name=description content="again this is for my self reference or for easy copy-paste for new projects.
Assume this is the production grade program we need to dockerize and run. package main import &#34;fmt&#34; func main() { fmt.Println(&#34;saying hello to the world&#34;) } Basic #-NAME: Dockerfile multistage build
FROM golang:1.14-alpine as builder WORKDIR /go/src/github.com/shabinesh/prog COPY main.go . COPY vendor ./vendor RUN go build -o main . FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR / COPY --from=0 /go/src/github."><meta name=keywords content="golang,docker,"><meta property="og:title" content="Docker Golang"><meta property="og:description" content="again this is for my self reference or for easy copy-paste for new projects.
Assume this is the production grade program we need to dockerize and run. package main import &#34;fmt&#34; func main() { fmt.Println(&#34;saying hello to the world&#34;) } Basic #-NAME: Dockerfile multistage build
FROM golang:1.14-alpine as builder WORKDIR /go/src/github.com/shabinesh/prog COPY main.go . COPY vendor ./vendor RUN go build -o main . FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR / COPY --from=0 /go/src/github."><meta property="og:type" content="article"><meta property="og:url" content="http://shabinesh.github.io/blog/notes/docker-golang/"><meta property="og:image" content="http://shabinesh.github.io/images/share.png"><meta property="article:section" content="blog"><meta property="article:published_time" content="2020-05-08T13:53:26+02:00"><meta property="article:modified_time" content="2020-05-08T13:53:26+02:00"><meta property="og:site_name" content="Sab's"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://shabinesh.github.io/images/share.png"><meta name=twitter:title content="Docker Golang"><meta name=twitter:description content="again this is for my self reference or for easy copy-paste for new projects.
Assume this is the production grade program we need to dockerize and run. package main import &#34;fmt&#34; func main() { fmt.Println(&#34;saying hello to the world&#34;) } Basic #-NAME: Dockerfile multistage build
FROM golang:1.14-alpine as builder WORKDIR /go/src/github.com/shabinesh/prog COPY main.go . COPY vendor ./vendor RUN go build -o main . FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR / COPY --from=0 /go/src/github."><meta itemprop=name content="Docker Golang"><meta itemprop=description content="again this is for my self reference or for easy copy-paste for new projects.
Assume this is the production grade program we need to dockerize and run. package main import &#34;fmt&#34; func main() { fmt.Println(&#34;saying hello to the world&#34;) } Basic #-NAME: Dockerfile multistage build
FROM golang:1.14-alpine as builder WORKDIR /go/src/github.com/shabinesh/prog COPY main.go . COPY vendor ./vendor RUN go build -o main . FROM alpine:latest RUN apk --no-cache add ca-certificates WORKDIR / COPY --from=0 /go/src/github."><meta itemprop=datePublished content="2020-05-08T13:53:26+02:00"><meta itemprop=dateModified content="2020-05-08T13:53:26+02:00"><meta itemprop=wordCount content="225"><meta itemprop=image content="http://shabinesh.github.io/images/share.png"><meta itemprop=keywords content="golang,docker,"><meta name=referrer content="no-referrer-when-downgrade"><style>body{font-family:Verdana,sans-serif;margin:auto;padding:20px;max-width:720px;text-align:left;background-color:#fff;word-wrap:break-word;overflow-wrap:break-word;line-height:1.5;color:#444}h1,h2,h3,h4,h5,h6,strong,b{color:#222}a{color:#3273dc}.title{text-decoration:none;border:0}.title span{font-weight:400}nav a{margin-right:10px}textarea{width:100%;font-size:16px}input{font-size:16px}content{line-height:1.6}table{width:100%}img{max-width:100%}code{padding:2px 5px;background-color:#f2f2f2}pre code{color:#222;display:block;padding:20px;white-space:pre-wrap;font-size:14px;overflow-x:auto}div.highlight pre{background-color:initial;color:initial}div.highlight code{background-color:unset;color:unset}blockquote{border-left:1px solid #999;color:#222;padding-left:20px;font-style:italic}footer{padding:25px;text-align:center}.helptext{color:#777;font-size:small}.errorlist{color:#eba613;font-size:small}ul.blog-posts{list-style-type:none;padding:unset}ul.blog-posts li{display:flex}ul.blog-posts li span{flex:0 0 130px}ul.blog-posts li a:visited{color:#8b6fcb}@media(prefers-color-scheme:dark){body{background-color:#333;color:#ddd}h1,h2,h3,h4,h5,h6,strong,b{color:#eee}a{color:#8cc2dd}code{background-color:#777}pre code{color:#ddd}blockquote{color:#ccc}textarea,input{background-color:#252525;color:#ddd}.helptext{color:#aaa}}</style></head><body><header><a href=/ class=title><h2>Sab's</h2></a><nav><a href=/>Home</a>
<a href=/blog>Blog</a></nav></header><main><h1>Docker Golang</h1><p><i><time datetime=2020-05-08 pubdate>08 May, 2020</time></i></p><content><p>again this is for my self reference or for easy copy-paste for new projects.</p><p>Assume this is the production grade program we need to dockerize and run.</p><div class="src src-go"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>     <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;saying hello to the world&#34;</span>)
</span></span><span style=display:flex><span>}</span></span></code></pre></div></div><div id=outline-container-headline-1 class=outline-3><h3 id=headline-1>Basic</h3><div id=outline-text-headline-1 class=outline-text-3><p>#-NAME: Dockerfile multistage build</p><div class="src src-text"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>FROM golang:1.14-alpine as builder
</span></span><span style=display:flex><span>WORKDIR /go/src/github.com/shabinesh/prog
</span></span><span style=display:flex><span>COPY main.go  .
</span></span><span style=display:flex><span>COPY vendor ./vendor
</span></span><span style=display:flex><span>RUN go build -o main .
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>FROM alpine:latest 
</span></span><span style=display:flex><span>RUN apk --no-cache add ca-certificates
</span></span><span style=display:flex><span>WORKDIR /
</span></span><span style=display:flex><span>COPY --from=0 /go/src/github.com/shabinesh/prog/main .
</span></span><span style=display:flex><span>CMD [&#34;./main&#34;]</span></span></code></pre></div></div></div></div><div id=outline-container-headline-2 class=outline-3><h3 id=headline-2>If the service depends on private repositor</h3><div id=outline-text-headline-2 class=outline-text-3><ul><li>set the `GOPRIVATE`</li><li>Update the git to include github token (in this case)</li></ul><div class="src src-shell"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>FROM golang:1.14-alpine AS builder
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>ARG GITHUB_TOKEN
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>WORKDIR /go/src/github.com/my-org/hello-service
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>RUN apk add --update bash make git curl ca-certificates
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span><span style=color:#75715e># Patch git to use a private token if one was provided</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>RUN <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -z <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>GITHUB_TOKEN<span style=color:#e6db74>}</span><span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    git config --global --add url.<span style=color:#e6db74>&#34;https://</span><span style=color:#e6db74>${</span>GITHUB_TOKEN<span style=color:#e6db74>}</span><span style=color:#e6db74>@github.com/my-org/&#34;</span>.insteadOf <span style=color:#e6db74>&#34;git@github.com:my-org/&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    git config --global --add url.<span style=color:#e6db74>&#34;https://</span><span style=color:#e6db74>${</span>GITHUB_TOKEN<span style=color:#e6db74>}</span><span style=color:#e6db74>@github.com/my-org/&#34;</span>.insteadOf <span style=color:#e6db74>&#34;https://github.com/my-org/&#34;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>    git config --global --add url.<span style=color:#e6db74>&#34;https://</span><span style=color:#e6db74>${</span>GITHUB_TOKEN<span style=color:#e6db74>}</span><span style=color:#e6db74>@github.com/my-org/&#34;</span>.insteadOf <span style=color:#e6db74>&#34;https://git@github.com/my-org/&#34;</span>; <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span> 
</span></span><span style=display:flex><span>RUN go mod vendor
</span></span><span style=display:flex><span>RUN go build -o main .</span></span></code></pre></div></div></div></div><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>docker-compose with service and postgres</h3><div id=outline-text-headline-3 class=outline-text-3><div class="src src-yaml"><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>version</span>: <span style=color:#e6db74>&#34;3.0&#34;</span>  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#f92672>hello-service</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>build</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>context</span>: <span style=color:#ae81ff>.</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>dockerfile</span>: <span style=color:#ae81ff>Dockerfile.dev</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>args</span>:
</span></span><span style=display:flex><span>       - <span style=color:#ae81ff>GITHUB_TOKEN</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>SERVER_PORT</span>: <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>   - <span style=color:#ae81ff>.:/go/src/github.com/my-org/hello-service</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>command</span>: <span style=color:#e6db74>&#34;CompileDaemon -build=&#39;make build&#39; -command=&#39;./build/hello-service&#39;&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>     - <span style=color:#e6db74>&#34;8000:80&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>depends_on</span>:
</span></span><span style=display:flex><span>     - <span style=color:#ae81ff>postgres</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span> <span style=color:#f92672>postgres</span>:
</span></span><span style=display:flex><span>   <span style=color:#f92672>image</span>: <span style=color:#ae81ff>postgres:12</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>     - <span style=color:#e6db74>&#34;5432:5432&#34;</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>environment</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>POSTGRES_USER</span>: <span style=color:#ae81ff>app_user</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>POSTGRES_PASSWORD</span>: <span style=color:#ae81ff>app_password</span>
</span></span><span style=display:flex><span>     <span style=color:#f92672>POSTGRES_DB</span>: <span style=color:#ae81ff>hello_service</span>
</span></span><span style=display:flex><span>   <span style=color:#f92672>healthcheck</span>:
</span></span><span style=display:flex><span>     <span style=color:#f92672>test</span>: [<span style=color:#e6db74>&#34;CMD-SHELL&#34;</span>, <span style=color:#e6db74>&#34;pg_isready -U ca&#34;</span>]
</span></span><span style=display:flex><span>     <span style=color:#f92672>retries</span>: <span style=color:#ae81ff>3</span></span></span></code></pre></div></div></div></div></content><p><a href=http://shabinesh.github.io/tags/golang/>#golang</a>
<a href=http://shabinesh.github.io/tags/docker/>#docker</a></p></main><footer>Made with <a href=https://github.com/janraasch/hugo-bearblog/>Hugo ʕ•ᴥ•ʔ Bear</a></footer></body></html>